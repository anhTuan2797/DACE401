<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style/page_header.css">
    <link rel="stylesheet" href="style/page_content.css">
    <link rel="stylesheet" href="style/admin_form.css">
</head>
<body onload="onLoad()">
    <div class="page_header" id="main_page_header">
        <a href="#" class="page_banner"><img src="https://daa.uit.edu.vn/sites/daa/files/banner.png" alt="main page banner" style="width: 100%; max-width: 100%; height: auto;"></a>
        <nav class="page_navbar" id="main_page_navbar">
        <ul class="page_navbar_link_list">
            <li><a href="admin_adjust_student_info.html">sinh viên</a></li>
            <li><a href="#">máy điểm danh</a></li>
        </ul>
        </nav>
    </div>

    <div class="page_content" id="admin_page_machine_content">
        <form action="#" method="GET" class="admin_form" id="admin_machine_search_form">
            <label>room</label>
            <input type="text" id="room_id">
            <button type="button" onclick="loadMachine()">search</button>
        </form>
        <form action="#" method="post" id="admin_machine_adjust_form" class="admin_form" style="border: 1px solid black;">
            <label> machine id</label>
            <select name="machineSelect" id="admin_machine_select">
                <option value="" style="display: none;">machine</option>
            </select>
            <button type="button" onclick="changeMachineRoom()">submit</button>
        </form>
        <p id="status" style="color: #CC3300;"></p>
        <div style="border: 1px solid black; display: grid; grid-template-columns: 20% 20%;">
            <h2 style="text-transform: uppercase;">reset password</h2>
            <button disabled="disabled" 
            style="background-color: #CC3300; color: black; border: none; cursor: pointer; margin: 15px;">
            reset</button>
        </div>
    </div>

    <script>

        function loadMachine(){
            var roomId = document.getElementById('room_id').value;
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = ()=>{
                if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
                    var machine = JSON.parse(xmlhttp.responseText);
                    if(machine){
                        document.getElementById('admin_machine_select').value = machine[0].machine_id;
                        document.getElementById('status').innerText = "";
                    }
                }
            };
            xmlhttp.open('GET','/getMachine');
            xmlhttp.setRequestHeader('roomId',roomId);
            xmlhttp.send();
        }

        function onLoad(){
            var roomSelect = document.getElementById('admin_machine_select')
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = ()=>{
                if(xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    var machineList = JSON.parse(xmlhttp.responseText);
                    for(id in machineList){
                        var option = document.createElement('option');
                        if(machineList[id].machine_id!='notAssign'){
                            option.text = machineList[id].machine_id;
                            roomSelect.add(option);
                        }
                    }
                }
            }
            xmlhttp.open('GET','/getAllMachine');
            xmlhttp.send();

        }

        function changeMachineRoom(){
            var machineId = document.getElementById('admin_machine_select').value;
            var roomId = document.getElementById('room_id').value;
            if(machineId && roomId){
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = ()=>{
                    if(xmlhttp.readyState == 4 && xmlhttp.status == 200){
                        document.getElementById('status').innerText = 'save success';
                    }
                }
                xmlhttp.open('POST','/saveMachineRoom');
                xmlhttp.setRequestHeader('roomId',roomId);
                xmlhttp.setRequestHeader('machineId',machineId);
                xmlhttp.send();
            }
        }

    </script>
</body>
</html>